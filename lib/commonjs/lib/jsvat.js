"use strict";var __assign=this&&this.__assign||function(){return(__assign=Object.assign||function(e){for(var r,t=1,n=arguments.length;t<n;t++)for(var i in r=arguments[t])Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i]);return e}).apply(this,arguments)},__spreadArray=this&&this.__spreadArray||function(e,r){for(var t=0,n=r.length,i=e.length;t<n;t++,i++)e[i]=r[t];return e},countries_1=(Object.defineProperty(exports,"__esModule",{value:!0}),exports.checkVAT=void 0,require("./countries"));function makeResult(e,r,t){return{value:e||void 0,isValid:Boolean(r),isValidFormat:!!t&&isVatValidToRegexp(e,t.rules.regex).isValid,isSupportedCountry:Boolean(t),country:t?{name:t.name,isoCode:{short:t.codes[0],long:t.codes[1],numeric:t.codes[2]}}:void 0}}function removeExtraChars(e){return(e=void 0===e?"":e).toString().toUpperCase().replace(/(\s|-|\.|\/)+/g,"")}function getCountryCodes(e){return __spreadArray(__spreadArray([],e.codes),["Greece"===e.name?"EL":void 0]).filter(Boolean)}var countriesVATDoesNotStartWithCountryCode=[countries_1.australia.name,countries_1.brazil.name,countries_1.norway.name];function isVATStartWithCountryCode(e){return!countriesVATDoesNotStartWithCountryCode.includes(e)}function isVATStartWithNumber(e){return!!e.match(/^\d{2}/)}function getCountry(e,r){for(var t=0,n=r;t<n.length;t++){var i=n[t];if(startsWithCode(e,i)||!isVATStartWithCountryCode(i.name)&&isVATStartWithNumber(e))return __assign({},i)}}function startsWithCode(r,e){return 0<getCountryCodes(e).filter(function(e){return r.startsWith(e)}).length}function isVatValidToRegexp(e,r){for(var t=0,n=r;t<n.length;t++){var i=n[t];if(i.test(e))return{isValid:!0,regex:i}}return{isValid:!1,regex:void 0}}function isVatValid(e,r){var t=isVatValidToRegexp(e,r.rules.regex);return!(!t.isValid||!t.regex||!(t=t.regex.exec(e)))&&r.calcFn(t[2])}function checkVAT(e,r){var t;return void 0===r&&(r=[]),e?makeResult(t=removeExtraChars(e),!!(r=getCountry(t,r))&&isVatValid(t,r),r):makeResult(e,!1)}exports.checkVAT=checkVAT;